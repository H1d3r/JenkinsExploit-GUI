package fun.fireline.tools;

import java.io.IOException;
import java.net.HttpURLConnection;
import java.net.URL;

public class  Jenkins_Info {
    public static int executionCount=0;
    public static String url="";
    public static String xJenkinsHeader="";
    public static String os="";

    public String getSystem(){
        return this.os;
    }

    public String get_Jenkions_Info(String url){
        //每一个url只获取一次信息,换url就重置次数
        if(executionCount!=0&&!this.url.equals(url)){
            this.executionCount=0;
        }
        //如果之前已经获取到了信息,就直接返回获取的信息
        if(this.executionCount>=1){
            return this.xJenkinsHeader;
        }
        this.url = url;
        this.os = System.getProperty("os.name").toLowerCase();
        this.executionCount++;
        try{
            URL urlObj = new URL(url);
            HttpURLConnection connection = (HttpURLConnection) urlObj.openConnection();
            connection.setRequestMethod("GET");
            this.xJenkinsHeader = connection.getHeaderField("X-Jenkins");
            if(xJenkinsHeader!=null){
                return this.xJenkinsHeader;
            }else {
                return null;
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
        return null;
    }
}
